#!/bin/sh

# using: PulseDroidRTP 
# https://github.com/wenxin-wang/PulseDroidRtp

main () {
    case "$1" in
        start)
            start ;;
        stop)
            stop ;;
        *)
            echo "usage: pashare [start|stop]"
            ;;
    esac
}

start () {
    stop &>/dev/null

    DEST=$(<$XDG_CONFIG_HOME/pashare/dest)

    pactl load-module module-null-sink \
        sink_name=rtp \
        sink_properties=device.description=RTP \
        format=s16be \
        channels=2 \
        rate=48000 >/dev/null

    pactl load-module module-rtp-send source=rtp.monitor destination=$DEST port=4010 mtu=320 >/dev/null
}

stop () {
    pactl unload-module module-null-sink
    pactl unload-module module-rtp-send
}

main "$@"
