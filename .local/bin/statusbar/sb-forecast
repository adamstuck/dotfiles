#!/bin/sh

LOCATION=$(cat "$XDG_CONFIG_HOME/forecast/location")

main () {
    case "$1" in
        -b|--browser)
            xdg-open "https://wttr.in/$LOCATION"
            exit 0 ;;
    esac

    res=$(curl -sf wttr.in/"$LOCATION"?format="%x+%t") || exit 1

    icon=$(condition_icon "$res")
    temp=$(temperature "$res")
    echo "$icon" "$temp"
}

condition_icon () {
    icon=$(echo "$1" | cut -d\  -f1)

    case "$icon" in
        'mm') echo     ;; 
        '=') echo      ;;  
        '///') echo    ;;    
        '//') echo     ;;
        '**') echo     ;;
        '*/*') echo    ;;
        '/') echo      ;;
        '.') echo      ;;
        'x') echo      ;;
        'x/') echo     ;;
        '*') echo      ;;
        '*/') echo     ;;
        'm') echo      ;;
        'o') echo      ;;
        '/!/') echo    ;;
        '!/') echo     ;;
        '*!*') echo    ;;
        'mmm') echo    ;;
        *) echo ? ;;
    esac
}

temperature () {
    echo "$1" | cut -d\  -f2 | sed 's/+//' | sed 's/C//'
}

main "$@"
